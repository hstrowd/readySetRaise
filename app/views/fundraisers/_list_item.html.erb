<div class="item fundraiser">
  <div class="header">
    <%= link_to fundraiser do %>
      <div class="title"><%= fundraiser.title %></div>
    <% end %>
    <div class="assoc-count">(<%= fundraiser.events.count %> <%= (fundraiser.events.count > 1) ? 'event'.pluralize : 'event' %>)</div>
  </div>
  <div class="attr description">
    <div class="value"><div class="label">Description:</div> <%= fundraiser.description %></div>
  </div>

  <!-- TODO: Consider rolling up the details in mobile environments. -->
  <% if fundraiser.has_ended? %>
    <div class="attr date ended">
      <div class="label">Ended At:</div>
      <div class="value"><%= fundraiser.pledge_end_time %></div>
    </div>
  <% elsif fundraiser.has_started? %>
    <div class="attr date ending">
      <div class="label">Ending At:</div>
      <div class="value"><%= fundraiser.pledge_end_time %></div>
    </div>
  <% else %>
    <div class="attr date starting">
      <div class="label">Starts At:</div>
      <div class="value"><%= fundraiser.pledge_start_time %></div>
    </div>
  <% end %>

  <% if fundraiser.has_started? %>
    <div class="attr pledges">
      <div class="label">Progress:</div>
      <div class="value">
        <!-- TODO: Find a way to format this percent and two decimal numbers properly. -->
        <div class="percent"><%= (fundraiser.pledge_total / fundraiser.pledge_target) %></div>
        <!-- TODO: Look into more efficient ways to handle pluralization. -->
        (<div class="total"><%= fundraiser.pledge_total %></div> / <div class="target"><%= fundraiser.pledge_target %></div>
        <div class="count">from <%= fundraiser.pledges.count %> <%= (fundraiser.pledges.count == 1) ? 'pledge' : 'pledges' %></div>)
      </div>
    </div>
  <% else %>
    <div class="attr plegde-target">
      <div class="label">Pledge Target:</div>
      <div class="value"><%= fundraiser.pledge_target %></div>
    </div>
  <% end %>
</div>

<script>
  $(function() { convertToLocalTime('.item.fundraiser .attr.date .value').show(); });
</script>
