<div class="fundraiser-form">
  <%= form_for(@fundraiser) do |f| %>

    <% if (@organizations.size == 1) %>
      <%= f.hidden_field(:organization_id, value: @organizations[0].id) %>
    <% else %>
      <% content_for 'organization_field' do %>
        <%= collection_select(:fundraiser, :organization_id, @organizations, :id, :name) %>
      <% end %>
      <%= render(partial: "shared/form_field", 
                 locals: { 
                   form: f, 
                   model: @fundraiser, 
                   attr: :organization
                 }) %>
    <% end %>

    <%= render(partial: "shared/form_field", 
               locals: { 
                 form: f, 
                 model: @fundraiser, 
                 attr: :title
               }) %>
    <% content_for 'description_field' do %>
      <%= f.text_area :description %>
    <% end %>
    <%= render(partial: "shared/form_field", 
               locals: { 
                 form: f, 
                 model: @fundraiser, 
                 attr: :description
               }) %>

    <% content_for 'pledge_start_time_field' do %>
      <%= f.hidden_field(:pledge_start_time) %>
      <% if !@fundraiser.errors[:pledge_start_time].empty? %>
        <div class="field_with_errors">
      <% end %>
      <%= text_field_tag :date_pledge_start, nil, class: 'datetime date' %>
      <div class="datetime-separator">at</div>
      <%= text_field_tag :time_pledge_start, nil, class: 'datetime time' %>
      <% if !@fundraiser.errors[:pledge_start_time].empty? %>
        </div>
      <% end %>
    <% end %>
    <%= render(partial: "shared/form_field", 
               locals: { 
                 form: f, 
                 model: @fundraiser, 
                 field_label: 'Pledge starts on',
                 attr: :pledge_start_time
               }) %>
    <% content_for 'pledge_end_time_field' do %>
      <%= f.hidden_field(:pledge_end_time) %>
       <% if !@fundraiser.errors[:pledge_end_time].empty? %>
         <div class="field_with_errors">
       <% end %>
       <%= text_field_tag :date_pledge_end, nil, class: 'datetime date' %>
       <div class="datetime-separator">at</div>
       <%= text_field_tag :time_pledge_end, nil, class: 'datetime time' %>
       <% if !@fundraiser.errors[:pledge_end_time].empty? %>
         </div>
       <% end %>
    <% end %>
    <%= render(partial: "shared/form_field", 
               locals: { 
                 form: f, 
                 model: @fundraiser,
                 field_label: 'Pledge ends on',
                 attr: :pledge_end_time
               }) %>

    <!-- TODO: Add a multi-select field for single event vs multi event fundraisers. -->

    <div class="actions">
      <%= f.submit "Schedule Fundraiser", class: :submit %>
    </div>

    <script>
      $(function() {
        var orgField = $( "#fundraiser_organization_id" );
        if (orgField && orgField.attr('type') != 'hidden') {
          orgField.combobox({
            editable: false
          });
        }

        initDateTimeField('fundraiser', 'pledge_start');
        initDateTimeField('fundraiser', 'pledge_end');
      });
    </script>

  <% end %>
</div>
